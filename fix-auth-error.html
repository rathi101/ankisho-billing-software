<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix MongoDB Authentication Error</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .step { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #007cba; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .code { background: #e9ecef; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; }
        .button { background: #007cba; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 5px 0; }
        .highlight { background: #ffeb3b; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîê Fix MongoDB Authentication Error</h1>
    
    <div class="step error">
        <h3>‚ùå Current Error</h3>
        <p><strong>MongoDB connection error:</strong> bad auth : authentication failed</p>
        <p><strong>Reason:</strong> Wrong username or password</p>
    </div>

    <div class="step">
        <h3>üîß Solution: Reset Database User</h3>
        
        <h4>Step 1: Go to MongoDB Atlas</h4>
        <p>1. Open <a href="https://cloud.mongodb.com" target="_blank" class="button">MongoDB Atlas</a></p>
        <p>2. Login and select your cluster</p>
        
        <h4>Step 2: Database Access</h4>
        <p>1. Click <strong>"Database Access"</strong> in left sidebar</p>
        <p>2. Delete existing user (if any)</p>
        <p>3. Click <strong>"Add New Database User"</strong></p>
        
        <h4>Step 3: Create New User</h4>
        <div class="code">
Username: <span class="highlight">ankisho</span>
Password: <span class="highlight">Ankisho123!</span>
Database User Privileges: <span class="highlight">Read and write to any database</span>
        </div>
        
        <p><strong>Important:</strong> Use simple password without special characters like @, #, $</p>
    </div>

    <div class="step warning">
        <h3>‚öôÔ∏è Get Correct Connection String</h3>
        
        <h4>Step 1: Connect Button</h4>
        <p>1. In MongoDB Atlas, click <strong>"Connect"</strong> on your cluster</p>
        <p>2. Choose <strong>"Connect your application"</strong></p>
        <p>3. Select <strong>"Node.js"</strong> driver</p>
        
        <h4>Step 2: Copy Connection String</h4>
        <p>You'll get something like:</p>
        <div class="code">
mongodb+srv://ankisho:&lt;password&gt;@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
        </div>
        
        <h4>Step 3: Replace Password</h4>
        <div class="code">
mongodb+srv://ankisho:Ankisho123!@cluster0.xxxxx.mongodb.net/ankisho-billing?retryWrites=true&w=majority
        </div>
    </div>

    <div class="step">
        <h3>üöÄ Update Render Environment</h3>
        
        <p>1. Go to <a href="https://render.com" target="_blank" class="button">Render Dashboard</a></p>
        <p>2. Select your backend service</p>
        <p>3. Go to <strong>"Environment"</strong> tab</p>
        <p>4. Update <strong>MONGODB_URI</strong>:</p>
        
        <div class="code">
MONGODB_URI=mongodb+srv://ankisho:Ankisho123!@cluster0.xxxxx.mongodb.net/ankisho-billing?retryWrites=true&w=majority
        </div>
        
        <p>5. Click <strong>"Save Changes"</strong></p>
        <p>6. Click <strong>"Manual Deploy"</strong></p>
    </div>

    <div class="step success">
        <h3>‚úÖ Test Connection</h3>
        
        <h4>Check Deployment Logs</h4>
        <p>1. In Render dashboard, go to <strong>"Logs"</strong></p>
        <p>2. Look for: <code>‚úÖ MongoDB connected successfully</code></p>
        <p>3. If error persists, check logs for details</p>
        
        <h4>Test Health Endpoint</h4>
        <p>Visit: <code>https://your-backend-url.onrender.com/api/health</code></p>
        <p>Should return: <code>{"success": true, "message": "Ankisho Billing Software API is running"}</code></p>
    </div>

    <div class="step warning">
        <h3>üí° Alternative: Use MongoDB Compass</h3>
        
        <p>Test connection locally first:</p>
        <p>1. Download <a href="https://www.mongodb.com/products/compass" target="_blank">MongoDB Compass</a></p>
        <p>2. Use connection string to test</p>
        <p>3. If connects in Compass, then use same string in Render</p>
    </div>

    <div class="step">
        <h3>üîç Common Authentication Issues</h3>
        
        <h4>Issue 1: Special Characters</h4>
        <p><strong>Problem:</strong> Password has @, #, $, etc.</p>
        <p><strong>Solution:</strong> Use simple password or URL encode</p>
        
        <h4>Issue 2: Wrong Database Name</h4>
        <p><strong>Problem:</strong> Missing database name in URL</p>
        <p><strong>Solution:</strong> Add <code>/ankisho-billing</code> before query params</p>
        
        <h4>Issue 3: User Permissions</h4>
        <p><strong>Problem:</strong> User doesn't have read/write access</p>
        <p><strong>Solution:</strong> Set "Read and write to any database"</p>
    </div>

    <div class="step success">
        <h3>üéØ Quick Summary</h3>
        <ol>
            <li>Create new MongoDB user: <code>ankisho</code> / <code>Ankisho123!</code></li>
            <li>Get fresh connection string from Atlas</li>
            <li>Update MONGODB_URI in Render</li>
            <li>Redeploy and check logs</li>
        </ol>
    </div>

    <script>
        console.log('üîê MongoDB Authentication Fix Guide Ready!');
        console.log('üìã Steps: 1) Create User 2) Get Connection String 3) Update Render 4) Test');
    </script>
</body>
</html>
